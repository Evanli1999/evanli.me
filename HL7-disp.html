<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	</head>

	<body>
		<form>
			The location of the HL7 file to be displayed: <input type="text" id="loc" value="https://raw.githubusercontent.com/Evanli1999/SeamlessMD-HL7-Display/master/patient3.json"/>
		</form>
		<button onclick="loadJSON()">Display File</button>
		<button onclick="clr()">Clear Console</button>

		<div id="main"> <br><br> Data Will Load Here: <br><br> </div>
        
        <script>
			function clr()
			{
				document.getElementById("main").innerHTML = "<br><br>Data Will Load Here: <br><br>";
			}
		
			function loadJSON() 
			{
				var place = document.getElementById("loc").value;
			
					//document.getElementById("main").append("started");
				var ourRequest = new XMLHttpRequest();
					//ourRequest.open('GET', 'http://evanli.me/patient.json');	
				ourRequest.open('GET', place);
					//document.getElementById("main").append("1");
					//document.getElementById("main").append(ourRequest.status);
				ourRequest.onload = function() 
				{
					if (ourRequest.status >= 200 && ourRequest.status < 400) 
					{
						var ourData = JSON.parse(ourRequest.responseText);
						var str = "<br>";

						
						str= "Name of\n Patient: " + ourData.name[0].given[0] + " " + ourData.name[0].family + "<br>";
						str+= "Organization Name: " + ourData.managingOrganization.display + "<br>";
						str+= "Gender: " + ourData.gender + "<br>";
						str+= "Number of Conditions: " + ourData.conditions.length + "<br>";
						
						for (var i = 0; i < ourData.conditions.length; i++)
						{
							str+="&nbsp&nbsp&nbsp&nbsp";
							str+=ourData.conditions[i];
							str+= "<br>";
						}
						
						//document.getElementById("main").append("Name of Patient :");
						//document.getElementById("main").append(ourData.name.given);
						//document.getElementById("main").append("Organization Name: " + ourData.managingOrganization.display + \n);
						//document.getElementById("main").append("Gender: " + ourData.gender + <br>);
						//document.getElementById("main").append("Number of Conditions: " + ourData.conditions.length);
						//document.getElementById("main").append("List of All Conditions: ");
						
						str+= " <b> EOF </b><br><br>";
						
						document.getElementById("main").innerHTML += str;
					} 
					else 
					{
					  document.getElementById("main").append("Connected, but not quite working :/");
					  //document.getElementById("main").append(ourRequest.status);
					}
				};
				
				ourRequest.onerror = function() 
				{
					document.getElementById("main").append(ourRequest.status);
				};
				
				ourRequest.send();
			}
		</script>
	</body>
</html>
